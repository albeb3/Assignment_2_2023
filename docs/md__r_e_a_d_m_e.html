<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>assignment_2_2023: Research track- Assignment 2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">assignment_2_2023
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Research track- Assignment 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repository contains a set of ROS nodes designed to accomplish specific tasks within a robot simulation environment. The implementation fulfills the following requirements:</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Task Description</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Node 1: Action Client Node</h2>
<ul>
<li><b>Functionality:</b><ul>
<li>Allows users to set a target (x, y) or cancel it.</li>
<li>Utilizes action server feedback/status to determine target achievement.</li>
<li>Publishes robot position and velocity as a custom message (x, y, vel_x, vel_z) based on the topic <code>/odom</code>.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Node 2: Service Node (Retrieve Last Target Coordinates)</h2>
<ul>
<li><b>Functionality:</b><ul>
<li>When called, returns the coordinates of the last target set by the user.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Node 3: Service Node (Robot's Distance &amp; Average Speed)</h2>
<ul>
<li><b>Functionality:</b><ul>
<li>Subscribes to robot position and velocity through a custom message.</li>
<li>Computes the distance from the target and the robot's average speed.</li>
<li>Parameterized with the averaging window size for speed calculations.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Launch File</h2>
<ul>
<li>Orchestrates the execution of all three nodes. </li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
- Configures the parameter for the third node to determine the averaging window size for speed calculation.</h1>
<p>To run the project, follow these steps:</p>
<ol type="1">
<li><b>Clone this repository to your system.</b> ```bash git clone <a href="https://github.com/albeb3/Assignment_2_2023.git">https://github.com/albeb3/Assignment_2_2023.git</a> ```</li>
<li><b>Install the necessary dependencies by running <code>catkin_make</code>.</b></li>
<li><b>Launch the main node using the provided launch file:</b> ```bash roslaunch assignment_2_2023 assignment2.launch ```</li>
<li><b>To use the service, execute:</b> ```bash rosservice call /dist_vel_service rosservice call /last_target_service ```</li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md8"></a>
Node 1: Action Client Node (&lt;tt&gt;client.cpp&lt;/tt&gt;)</h2>
<ul>
<li><b>Language and Files:</b><ul>
<li>Implemented in C++.</li>
<li>Located in the <code>src</code> folder named <code><a class="el" href="client_8cpp.html" title="Action Client Node.">client.cpp</a></code>.</li>
<li>Utilizes a message file named <code>Posvel.h</code>, containing fields <code>x</code>, <code>y</code>, <code>vel_x</code>, and <code>vel_y</code>.</li>
</ul>
</li>
<li><b>Message Structure:</b><ul>
<li>Created a custom message file (<code>Posvel.h</code>) with <code>float64</code> fields (<code>x</code>, <code>y</code>, <code>vel_x</code>, and <code>vel_y</code>).</li>
<li>The decision to use <code>vel_y</code> instead of <code>vel_z</code> was made for coherence with the third node's requirement for calculating average speed, ensuring consistency within the system's data structure.</li>
</ul>
</li>
<li><b>Initialization:</b><ul>
<li>Initializes a ROS node, sets up a publisher to send information using the custom message, and subscribes to the <code>/odom</code> topic via the <code>odomCallback</code> function to gather robot position and velocity data.</li>
<li>Utilizes <code>std::thread</code> functionality to enable continuous transmission by the publisher while allowing user interaction without blocking the execution.</li>
</ul>
</li>
<li><b>Functionality:</b><ul>
<li><b>Target Handling:</b><ul>
<li>Initializes a <code>busy</code> variable as <code>false</code>.</li>
<li>Prompts the user to input target/goal coordinates initially.</li>
<li>Changes <code>busy</code> to <code>true</code> after acquiring the target coordinates.</li>
</ul>
</li>
<li><b>User Interaction:</b><ul>
<li>Based on the <code>busy</code> state, prompts the user to either cancel the goal or check if the goal has been reached.</li>
</ul>
</li>
<li><b>Goal Transmission:</b><ul>
<li>After populating the goal field of the action message with the target coordinates, the client sends this data using the <code>sendGoal()</code> functionality to the server.</li>
</ul>
</li>
<li><b>Goal Status Check:</b><ul>
<li>Implements code to request the server's goal status using the <code>getState</code> functionality when the user checks if the goal is reached.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md10"></a>
Node 2: Service Node (&lt;tt&gt;last_target.cpp&lt;/tt&gt;)</h2>
<ul>
<li><b>Language and Files:</b><ul>
<li>Implemented in C++.</li>
<li>Located in the <code>src</code> folder named <code><a class="el" href="last__target_8cpp.html" title="Service Node.">last_target.cpp</a></code>.</li>
<li>Utilizes a service file (<code>.srv</code>) containing a response with two <code>float32</code> fields: <code>goal_x</code> and <code>goal_y</code>, without a request field.</li>
</ul>
</li>
<li><b>Service Structure:</b><ul>
<li>Created a service file defining the service structure without a request but containing <code>goal_x</code> and <code>goal_y</code> as response fields of type <code>float32</code>.</li>
</ul>
</li>
<li><b>Initialization:</b><ul>
<li>Initializes the <code>last_target_service</code> node.</li>
<li>Sets up a subscriber to listen to the <code>/reaching_goal/goal</code> topic, extracting goal coordinates using the <code>target_position</code> callback function.</li>
</ul>
</li>
<li><b>Service Server:</b><ul>
<li>Establishes a <code>ServiceServer</code> named <code>/last_target_service</code> to respond to service requests.</li>
<li>Implements the <code>send_position</code> function, retrieving and returning the last goal's coordinates upon service request.</li>
</ul>
</li>
<li><b>Observations:</b><ul>
<li>The <code>target_position</code> callback captures goal coordinates upon receiving messages from the <code>/reaching_goal/goal</code> topic.</li>
<li>The <code>send_position</code> function responds to service requests on <code>/last_target_service</code> by providing the last received goal's coordinates.</li>
</ul>
</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md12"></a>
Node 3: Service Node (&lt;tt&gt;dist_vel.cpp&lt;/tt&gt;)</h2>
<ul>
<li><b>File Structure:</b><ul>
<li>Implemented in C++.</li>
<li>Located in <code>src</code> folder as <code><a class="el" href="dist__vel_8cpp.html" title="Service Node.">dist_vel.cpp</a></code>.</li>
<li>Utilizes a custom <code>.srv</code> file named <code>Dist_vel</code> located in the <code>srv</code> folder.</li>
</ul>
</li>
<li><b>Service Structure:</b><ul>
<li>The <code>Dist_vel</code> service file defines the service structure without a request but containing the distance from the goal and the robot's average speed as response fields of type <code>float32</code>.</li>
</ul>
</li>
<li><b>Initialization:</b><ul>
<li>Initializes two subscribers:<ul>
<li>Subscribes to <code>/reaching_goal/goal</code> to obtain target coordinates via the <code>target_position</code> callback.</li>
<li>Subscribes to <code>/posvel</code> to retrieve robot's coordinates and velocity using <code>dataCallback</code>.</li>
</ul>
</li>
</ul>
</li>
<li><b>Functionality:</b><ul>
<li>**<code>target_position</code> Callback:**<ul>
<li>Extracts and stores the goal's coordinates in <code>goal_x</code> and <code>goal_y</code> variables.</li>
</ul>
</li>
<li>**<code>dataCallback</code> Function:**<ul>
<li>Gathers robot's coordinates (position_x, position_y) and velocity (vel_x, vel_y).</li>
<li>Utilizes two functions inside this callback:<ul>
<li>Calculates the distance between the robot and the goal.</li>
<li>Computes the average speed based on a vector with a dimension set by <code>get:param</code> from the launch file.</li>
</ul>
</li>
</ul>
</li>
<li><b>Average Speed Calculation:</b><ul>
<li>Utilizes a vector to store the velocity values obtained from the callback.</li>
<li>Implements counters for managing vector updates with the modulo operator.</li>
<li>Calculates the average speed by summing up values in the array and dividing by the total number of values.</li>
</ul>
</li>
<li><b>ServiceServer:</b><ul>
<li>Establishes <code>/dist_vel_service</code> as a <code>ServiceServer</code> to retrieve average speed and distance from the goal.</li>
<li>The <code>send_info</code> function populates the fields of the <code>Dist_vel</code> service message with velocity and distance values obtained from <code>dataCallback</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://github.com/albeb3/Assignment_2_2023/blob/main/nodiassignment%20RT.jpg" alt="rosrun rqt_graph rqt_graph" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md13"></a>
Pseudochode Node 1 (Action Client Node &lt;tt&gt;client.cpp&lt;/tt&gt;)</h2>
<h1><a class="anchor" id="autotoc_md14"></a>
ROS Node - Goal Sender</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
Initialization</h2>
<ol type="1">
<li>Create ROS publisher for position and speed of the robot</li>
<li>Create ROS subscriber for Odometry messages</li>
<li>Create an action client for the PlanningAction</li>
<li>Create a thread for user input</li>
</ol>
<h2><a class="anchor" id="autotoc_md16"></a>
UserInput Thread</h2>
<ol type="1">
<li>While ROS is okay and not shutting down:<ul>
<li>If the action has finished and the robot is busy:<ul>
<li>Get and print the action status</li>
<li>Set busy to false</li>
</ul>
</li>
<li>Else if the robot is not busy:<ul>
<li>Display a prompt to insert the goal coordinates (x, y)</li>
<li>Read and validate user input for x coordinate</li>
<li>Read and validate user input for y coordinate</li>
<li>Display a message indicating the goal is being sent</li>
<li>Send the goal using the action client</li>
<li>Set busy to true</li>
</ul>
</li>
<li>Else if the robot is busy:<ul>
<li>Display options to the user (cancel goal, check goal)</li>
<li>Read user input</li>
<li>If user chooses to cancel goal:<ul>
<li>Cancel the goal using the action client</li>
<li>Display a message indicating the goal is canceled</li>
<li>Set busy to false</li>
</ul>
</li>
<li>Else if user chooses to check goal:<ul>
<li>Display a message indicating to wait for the result and try again</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md17"></a>
Main Loop</h2>
<ol type="1">
<li>While ROS is okay:<ul>
<li>Create Posvel message</li>
<li>Populate the message with robot position and speed</li>
<li>Publish the message</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md18"></a>
End</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
